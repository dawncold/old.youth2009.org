<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: GFW | Trade Off]]></title>
  <link href="http://www.youth2009.org/blog/categories/gfw/atom.xml" rel="self"/>
  <link href="http://www.youth2009.org/"/>
  <updated>2013-12-03T23:37:03+08:00</updated>
  <id>http://www.youth2009.org/</id>
  <author>
    <name><![CDATA[dawncold]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[ssh-proxy-with-autossh-in-mac]]></title>
    <link href="http://www.youth2009.org/blog/2013/05/11/ssh-proxy-with-autossh/"/>
    <updated>2013-05-11T13:10:00+08:00</updated>
    <id>http://www.youth2009.org/blog/2013/05/11/ssh-proxy-with-autossh</id>
    <content type="html"><![CDATA[<p>在Mac下原来一直用iSSH，好处是简单，功能够用，但有个缺点很致命，ssh有时候会断开，谁知道最终是什么原因导致的，但iSSH不会自动重连，只是提示你。在忍受了很久之后换成了autossh，它没有GUI，但可以在ssh断开后自动重连。</p>

<p>1.使用brew安装autossh，或者用其他工具安装autossh，包括手。</p>

<p><code>brew install autossh</code></p>

<p>2.配置你的海外主机，保证你可以不用密码登陆。无非就是在authorized_keys中加入你的public key。自己用ssh登陆只要不用密码了就ok。</p>

<p>3.用autossh连接。</p>

<p><code>autossh -M 20000 -f -p REMOTEPORT -D LOCALPORT xxx@8.8.8.8 -N</code></p>

<p>autossh就3个参数，-M、-f、-V，其中-V是显示版本，其余两个参数的意思看<a href="http://www.harding.motd.ca/autossh/README" title="autossh README">文档描述</a>吧。</p>

<p>如果你没改远程主机ssh的默认端口，那就省略-p REMOTEPORT。</p>

<p>指定一个LOCALPORT，一般用什么1080，我用9998。</p>

<p>后面是ssh连接信息，最后-N表示port forward不用terminal交互。</p>

<p>4.(可选操作)如果你比较懒，希望login系统的时候自动帮你连接上ssh，Mac下使用launchd来做，推荐使用Lingon这个app，是个launchd的GUI。</p>

<p>添加一个My Agents就可以了，何时运行那里我勾选了at startup or login，生成的plist会放在~/Library/LaunchAgents/中，生成的内容如下：</p>

<p><code>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
&lt;dict&gt;
&lt;key&gt;Label&lt;/key&gt;
&lt;string&gt;autossh&lt;/string&gt;
&lt;key&gt;ProgramArguments&lt;/key&gt;
&lt;array&gt;
&lt;string&gt;/usr/local/bin/autossh&lt;/string&gt;
&lt;string&gt;-M&lt;/string&gt;
&lt;string&gt;20000&lt;/string&gt;
&lt;string&gt;-f&lt;/string&gt;
&lt;string&gt;-p&lt;/string&gt;
&lt;string&gt;9999&lt;/string&gt;
&lt;string&gt;-D&lt;/string&gt;
&lt;string&gt;9998&lt;/string&gt;
&lt;string&gt;google@8.8.8.8&lt;/string&gt;
&lt;string&gt;-N&lt;/string&gt;
&lt;/array&gt;
&lt;key&gt;RunAtLoad&lt;/key&gt;
&lt;true/&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></p>

<p>至此，开机自动连接ssh，自由surfing吧。</p>
]]></content>
  </entry>
  
</feed>
