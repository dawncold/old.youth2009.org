<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: vpn | dawncold's tech blog]]></title>
  <link href="http://www.youth2009.org/blog/categories/vpn/atom.xml" rel="self"/>
  <link href="http://www.youth2009.org/"/>
  <updated>2013-01-01T08:36:58+08:00</updated>
  <id>http://www.youth2009.org/</id>
  <author>
    <name><![CDATA[dawncold]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[centos5上ppp、pptpd配置VPN]]></title>
    <link href="http://www.youth2009.org/blog/2011/08/13/config-vpn-on-centos5-use-ppp-and-pptpd/"/>
    <updated>2011-08-13T17:53:00+08:00</updated>
    <id>http://www.youth2009.org/blog/2011/08/13/config-vpn-on-centos5-use-ppp-and-pptpd</id>
    <content type="html"><![CDATA[<pre><code>        &lt;p&gt;安装ppp：&lt;/p&gt;
</code></pre>

<br /><pre class="prettyprint linenums bush:bash" lang="bash">yum install ppp</pre>


<br /><p>下载pptpd：</p>


<p> </p>


<br /><pre class="prettyprint linenums bush:bash" lang="bash">wget -c http://poptop.sourceforge.net/yum/stable/packages/pptpd-1.3.4-1.rhel5.1.x86_64.rpm</pre>


<br /><p>安装pptpd：</p>


<br /><pre class="prettyprint linenums bush:bash" lang="bash">rpm -ivh pptpd-1.3.4-1.rhel5.1.x86_64.rpm</pre>


<br /><p>修改参数：</p>


<br /><pre class="prettyprint linenums bush:bash" lang="bash">vi /etc/ppp/options.pptpd</pre>


<br /><p>ms-dns 8.8.8.8和ms-dns 8.8.4.4(这里用了Google的dns，你可以用别的)</p>


<p>加入分配IP等信息：</p>


<br /><pre class="prettyprint linenums bush:bash" lang="bash">vi /etc/pptpd.conf</pre>


<br /><p>localip 192.168.0.1</p>


<p>remoteip 192.168.0.2-30(意思是连接上分配一个2～30的地址)</p>


<p>加入账号密码：</p>


<br /><pre class="prettyprint linenums bush:bash" lang="bash">vi /etc/ppp/chap-secrets</pre>


<br /><p>用空格分开：USERNAME pptpd PASSWORD *   (最后的这个星号意思是不指定IP，自动分给你一个，pptpd是在配置文件中写的一个服务名称，默认就是这个，不用再修改了，你需要更改的就是大写的两组值)</p>


<p>修改转发参数：</p>


<br /><pre class="prettyprint linenums bush:bash" lang="bash">vi /etc/sysctl.conf</pre>


<br /><p>把net.ipv4.ip_forward = 0改正1保存退出</p>


<br /><pre class="prettyprint linenums bush:bash" lang="bash">/sbin/sysctl -p


<p>使刚才配置的转发参数生效，你能够看到系统打印出的参数列表，应该能够看到ip_forward = 1了</pre></p>

<br /><p>启动pptpd：</p>


<br /><pre class="prettyprint linenums bush:bash" lang="bash">/sbin/services pptpd start


<p></pre></p>

<br /><p>配置iptables内容：</p>


<br /><pre class="prettyprint linenums bush:bash" lang="bash">/sbin/iptables -A INPUT -p tcp --dport 1723 -j ACCEPT


<p>/sbin/iptables -A INPUT -p tcp --dport 47 -j ACCEPT
/sbin/iptables -A INPUT -p gre -j ACCEPT
/sbin/iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o eth0 -j MASQUERADE</pre></p>

<br /><p>解释一下，前两行是开启1723和47端口，第三行是允许GRE协议，最后一行是设置转发到eth0轮询。至于这个轮询的概念我就不太清楚了。转发到eth0也就是说把请求发送到了网卡eth0，这个可以在/sbin/ifconfig看到网卡的名字。</p>


<p>保存iptables规则，重启iptables：</p>


<br /><pre class="prettyprint linenums bush:bash" lang="bash">/etc/init.d/iptables save


<p>/etc/init.d/iptables restart
如果原有iptables内容可能会和现有的冲突，所以发现问题后先检查一下这里，毕竟iptables是控制连接的所有出口</pre></p>

<br /><p>下面这两条根据需要执行吧：</p>


<br /><pre class="prettyprint linenums bush:bash" lang="bash">/sbin/chkconfig pptpd on


<p>/sbin/chkconfig iptables on</pre></p>

<br /><p>分别是让pptpd和iptables机器再次重启后也能运行。</p>


<p>工作都完成了，连接上试试吧，用pptp方式连接哦，别的方式没用过，应该是不行的。有时候连接上不能访问网页建议断开几次再连接上试试，我曾更改了mtu，发现没什么作用，应该不出问题默认的都能用，服务器一般建立的ppp0、1、2……这些的mtu都是1496，本机对应的是1444，具体算法不想深究。</p>

]]></content>
  </entry>
  
</feed>
