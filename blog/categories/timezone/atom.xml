<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: timezone | dawncold's tech blog]]></title>
  <link href="http://www.youth2009.org/blog/categories/timezone/atom.xml" rel="self"/>
  <link href="http://www.youth2009.org/"/>
  <updated>2013-06-04T23:05:46+08:00</updated>
  <id>http://www.youth2009.org/</id>
  <author>
    <name><![CDATA[dawncold]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[pytz的6分钟时差]]></title>
    <link href="http://www.youth2009.org/blog/2012/10/20/6-minutes-offset-in-pytz/"/>
    <updated>2012-10-20T16:13:00+08:00</updated>
    <id>http://www.youth2009.org/blog/2012/10/20/6-minutes-offset-in-pytz</id>
    <content type="html"><![CDATA[<p>项目中有使用pytz这个第三方库来处理datetiem相关的东西。不过最近测试的时候发现，创建了一个时间点后，最终得到的时间点和预想的时间点有6分钟的误差，从网上搜到的资料是这样解决的：详情看<a href="http://hi.baidu.com/limodou/item/72da32384b25c7ff97f88df1">http://hi.baidu.com/limodou/item/72da32384b25c7ff97f88df1</a></p>

<p>创建datetime的时候，特别是带timezone，需要localize一下，否则在使用pytz的时候就会出现这6分钟的差异。代码中首先创建了datetime，然后localize后再replace了timezone为pytz的，最终还astimezone为pytz.utc。我们是使用utc的，你的代码也许不需要：）</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[设置Rails中的timezone]]></title>
    <link href="http://www.youth2009.org/blog/2012/02/15/set-timezone-in-rails/"/>
    <updated>2012-02-15T14:37:00+08:00</updated>
    <id>http://www.youth2009.org/blog/2012/02/15/set-timezone-in-rails</id>
    <content type="html"><![CDATA[<pre><code>        &lt;p&gt;Timezone是很关键的东西哦，特别是某些app根据时间来作出不同反映的时候设置好Timezone就是必须的了。&lt;/p&gt;
</code></pre>

<p>没设置之前，插入到数据库中的时间都是utc时间，晚8小时，修改两处就差不多正常了：）编辑config/application.rb，我用的是Rails3.2.1</p>


<br /><pre class="prettyprint linenums bush:ruby" lang="ruby">config.active_record.default_timezone = :local  


<p>config.time_zone = &lsquo;Beijing&rsquo;  </pre></p>

<br /><p>为何我说差不多呢，原因如下：</p>


<br /><pre class="prettyprint linenums bush:ruby" lang="ruby">irb(main):001:0&gt; Fpwd.store(1)


<p>  Fpwd Load (0.2ms)  SELECT &ldquo;fpwds&rdquo;.* FROM &ldquo;fpwds&rdquo; WHERE &ldquo;fpwds&rdquo;.&ldquo;user_id&rdquo; = 1 LIMIT 1
  SQL (2.7ms)  DELETE FROM &ldquo;fpwds&rdquo; WHERE &ldquo;fpwds&rdquo;.&ldquo;user_id&rdquo; = 1
   (0.1ms)  begin transaction
Binary data inserted for <code>string</code> type on column <code>randstring</code>
  SQL (429.6ms)  INSERT INTO &ldquo;fpwds&rdquo; (&ldquo;created_at&rdquo;, &ldquo;randstring&rdquo;, &ldquo;updated_at&rdquo;, &ldquo;user_id&rdquo;) VALUES (?, ?, ?, ?)  [[&ldquo;created_at&rdquo;, Wed, 15 Feb 2012 14:29:35 CST +08:00], [&ldquo;randstring&rdquo;, &ldquo;87e685e0d2ab37143fae248083822ffea600f577&rdquo;], [&ldquo;updated_at&rdquo;, Wed, 15 Feb 2012 14:29:35 CST +08:00], [&ldquo;user_id&rdquo;, 1]]
   (1.4ms)  commit transaction
=&gt; #&lt;Fpwd user_id: 1, randstring: &ldquo;87e685e0d2ab37143fae248083822ffea600f577&rdquo;, created_at: &ldquo;2012-02-15 06:29:35&rdquo;, updated_at: &ldquo;2012-02-15 06:29:35&rdquo;&gt;</pre></p>

<br /><p>最后的返回值那里还是晚了8小时，我用sqlite3查看的时候时间是正常的，所以这里怀疑是ruby的时间问题了，好在app中已经正常！</p>

]]></content>
  </entry>
  
</feed>
